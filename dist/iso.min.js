"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(a,t,r){if(t)e(a.prototype,t);if(r)e(a,r);return a}}();function _classCallCheck(e,a){if(!(e instanceof a)){throw new TypeError("Cannot call a class as a function")}}var escapeTextForBrowser=require("escape-html");var each=function e(a,t){return Array.prototype.forEach.call(a,t)};var parse=function a(e,t){return JSON.parse(e.getAttribute(t))};var setDefaults=function t(e){e.markupClassName=e.markupClassName||"___iso-html___";e.markupElement=e.markupElement||"div";e.dataClassName=e.dataClassName||"___iso-state___";e.dataElement=e.dataElement||"div"};var Iso=function(){function e(a){_classCallCheck(this,e);setDefaults(a);this.markupClassName=a.markupClassName;this.markupElement=a.markupElement;this.dataClassName=a.dataClassName;this.dataElement=a.dataElement;this.html=[];this.data=[]}_createClass(e,[{key:"add",value:function a(e){var a=arguments[1]===undefined?{}:arguments[1];var t=arguments[2]===undefined?{}:arguments[2];var r=escapeTextForBrowser(JSON.stringify(a));var n=escapeTextForBrowser(JSON.stringify(t));this.html.push(e);this.data.push({state:r,meta:n});return this}},{key:"render",value:function t(){var e=this;var a=this.html.reduce(function(a,t,r){return a+("<"+e.markupElement+' class="'+e.markupClassName+'" data-key="'+r+'">'+t+"</"+e.markupElement+">")},"");var t=this.data.reduce(function(a,t,r){var n=t.state;var s=t.meta;return a+("<"+e.dataElement+' class="'+e.dataClassName+'" data-key="'+r+'" data-meta="'+s+'" data-state="'+n+'"></'+e.dataElement+">")},"");return"\n"+a+"\n"+t+"\n"}}],[{key:"render",value:function r(a){var t=arguments[1]===undefined?{}:arguments[1];var r=arguments[2]===undefined?{}:arguments[2];var n=arguments[3]===undefined?{markupClassName:"___iso-html___",markupElement:"div",dataClassName:"___iso-state___",dataElement:"div"}:arguments[3];return new e(n).add(a,t,r).render()}},{key:"bootstrap",value:function n(e){var a=arguments[1]===undefined?"___iso-html___":arguments[1];var t=arguments[2]===undefined?"___iso-state___":arguments[2];if(!e){return}var r=document.querySelectorAll("."+a);var n=document.querySelectorAll("."+t);var s={};each(n,function(e){var a=parse(e,"data-meta");var t=parse(e,"data-state");s[e.getAttribute("data-key")]={meta:a,state:t}});each(r,function(a){var t=a.getAttribute("data-key");if(!s[t]){return}var r=s[t];var n=r.meta;var u=r.state;e(u,n,a)});s=null}},{key:"on",value:function s(a,t,r){e.bootstrap(function(e,n,s){if(n[a]&&n[a]===t){r(e,n,s)}})}}]);return e}();exports["default"]=Iso;module.exports=exports["default"];
