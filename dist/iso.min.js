"use strict";var _createClass=function(){function a(a,e){for(var t in e){var r=e[t];r.configurable=true;if(r.value)r.writable=true}Object.defineProperties(a,e)}return function(e,t,r){if(t)a(e.prototype,t);if(r)a(e,r);return e}}();var _classCallCheck=function(a,e){if(!(a instanceof e)){throw new TypeError("Cannot call a class as a function")}};var escapeTextForBrowser=require("escape-html");var each=function(a,e){return Array.prototype.forEach.call(a,e)};var parse=function(a,e){return JSON.parse(a.getAttribute(e))};var Iso=function(){function a(e){_classCallCheck(this,a);this.markupClassName=e.markupClassName||"___iso-html___";this.markupElement=e.markupElement||"div";this.dataClassName=e.dataClassName||"___iso-state___";this.dataElement=e.dataElement||"div";this.html=[];this.data=[]}_createClass(a,{add:{value:function e(a){var e=arguments[1]===undefined?{}:arguments[1];var t=arguments[2]===undefined?{}:arguments[2];var r=escapeTextForBrowser(JSON.stringify(e));var n=escapeTextForBrowser(JSON.stringify(t));this.html.push(a);this.data.push({state:r,meta:n});return this}},render:{value:function t(){var a=this;var e=this.html.reduce(function(e,t,r){return e+("<"+a.markupElement+' class="'+a.markupClassName+'" data-key="'+r+'">'+t+"</"+a.markupElement+">")},"");var t=this.data.reduce(function(e,t,r){var n=t.state;var s=t.meta;return e+("<"+a.dataElement+' class="'+a.dataClassName+'" data-key="'+r+'" data-meta="'+s+'" data-state="'+n+'"></'+a.dataElement+">")},"");return"\n"+e+"\n"+t+"\n"}}},{render:{value:function r(e,t){var r=arguments[0]===undefined?{markupClassName:"___iso-html___",markupElement:"div",dataClassName:"___iso-state___",dataElement:"div"}:arguments[0];var n=arguments[2]===undefined?{}:arguments[2];var s=arguments[3]===undefined?{}:arguments[3];return new a(r).add(t,n,s).render()}},bootstrap:{value:function n(a){if(!a){return}var e=document.querySelectorAll("."+this.markupClassName);var t=document.querySelectorAll("."+this.dataClassName);var r={};each(t,function(a){var e=parse(a,"data-meta");var t=parse(a,"data-state");r[a.getAttribute("data-key")]={meta:e,state:t}});each(e,function(e){var t=e.getAttribute("data-key");if(!r[t]){return}var n=r[t];var s=n.meta;var u=n.state;a(u,s,e)});r=null}},on:{value:function s(e,t,r){a.bootstrap(function(a,n,s){if(n[e]&&n[e]===t){r(a,n,s)}})}}});return a}();module.exports=Iso;
