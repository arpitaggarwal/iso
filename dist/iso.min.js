"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function a(a,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(a,r.key,r)}}return function(e,t,r){if(t)a(e.prototype,t);if(r)a(e,r);return e}}();function _classCallCheck(a,e){if(!(a instanceof e)){throw new TypeError("Cannot call a class as a function")}}var escapeTextForBrowser=require("escape-html");var defaultConfiguration={markupClassName:"___iso-html___",markupElement:"div",dataClassName:"___iso-state___",dataElement:"div"};var each=function a(e,t){return Array.prototype.forEach.call(e,t)};var parse=function e(a,t){return JSON.parse(a.getAttribute(t))};var setDefaults=function t(a){a.markupClassName=a.markupClassName||defaultConfiguration.markupClassName;a.markupElement=a.markupElement||defaultConfiguration.markupElement;a.dataClassName=a.dataClassName||defaultConfiguration.dataClassName;a.dataElement=a.dataElement||defaultConfiguration.dataElement};var Iso=function(){function a(){var e=arguments[0]===undefined?defaultConfiguration:arguments[0];_classCallCheck(this,a);setDefaults(e);this.markupClassName=e.markupClassName;this.markupElement=e.markupElement;this.dataClassName=e.dataClassName;this.dataElement=e.dataElement;this.html=[];this.data=[]}_createClass(a,[{key:"add",value:function e(a){var e=arguments[1]===undefined?{}:arguments[1];var t=arguments[2]===undefined?{}:arguments[2];var r=escapeTextForBrowser(JSON.stringify(e));var n=escapeTextForBrowser(JSON.stringify(t));this.html.push(a);this.data.push({state:r,meta:n});return this}},{key:"render",value:function t(){var a=this;var e=this.html.reduce(function(e,t,r){return e+("<"+a.markupElement+' class="'+a.markupClassName+'" data-key="'+r+'">'+t+"</"+a.markupElement+">")},"");var t=this.data.reduce(function(e,t,r){var n=t.state;var u=t.meta;return e+("<"+a.dataElement+' class="'+a.dataClassName+'" data-key="'+r+'" data-meta="'+u+'" data-state="'+n+'"></'+a.dataElement+">")},"");return"\n"+e+"\n"+t+"\n"}}],[{key:"render",value:function r(e){var t=arguments[1]===undefined?{}:arguments[1];var r=arguments[2]===undefined?{}:arguments[2];var n=arguments[3]===undefined?defaultConfiguration:arguments[3];return new a(n).add(e,t,r).render()}},{key:"bootstrap",value:function n(a){var e=arguments[1]===undefined?defaultConfiguration:arguments[1];setDefaults(e);if(!a){return}var t=document.querySelectorAll("."+e.markupClassName);var r=document.querySelectorAll("."+e.dataClassName);var n={};each(r,function(a){var e=parse(a,"data-meta");var t=parse(a,"data-state");n[a.getAttribute("data-key")]={meta:e,state:t}});each(t,function(e){var t=e.getAttribute("data-key");if(!n[t]){return}var r=n[t];var u=r.meta;var s=r.state;a(s,u,e)});n=null}},{key:"on",value:function u(e,t,r){var n=arguments[3]===undefined?defaultConfiguration:arguments[3];setDefaults(n);a.bootstrap(function(a,n,u){if(n[e]&&n[e]===t){r(a,n,u)}},n)}}]);return a}();exports["default"]=Iso;module.exports=exports["default"];
