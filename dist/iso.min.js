"use strict";var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}return function(r,t,n){if(t)e(r.prototype,t);if(n)e(r,n);return r}}();Object.defineProperty(exports,"__esModule",{value:true});function _classCallCheck(e,r){if(!(e instanceof r)){throw new TypeError("Cannot call a class as a function")}}var KEY_NAME="data-iso-key";var rLt=/</g;var rGt=/>/g;var rLte=/&lt;/g;var rGte=/&gt;/g;var rEnc=/[<>]/;var rDec=/&lt;|&gt;/;var coerceToString=function e(r){return r?String(r):""};var defaultRenderer={markup:function(){function e(e,r){if(!e)return"";return"<div "+KEY_NAME+'="'+String(r)+'">'+String(e)+"</div>"}return e}(),data:function(){function e(e,r){if(!e)return"";return'<script type="application/json" '+KEY_NAME+'="'+String(r)+'">'+String(e)+"</script>"}return e}()};var defaultSelector=function r(){var e=document.querySelectorAll("["+KEY_NAME+"]");return Array.prototype.reduce.call(e,function(e,r){var t=r.getAttribute(KEY_NAME);if(!e[t])e[t]={};if(r.nodeName==="SCRIPT"){try{var n=JSON.parse(Iso.decode(r.innerHTML));e[t].state=n}catch(a){e[t].state={}}}else{e[t].node=r}return e},{})};var Iso=function(){function e(){var r=arguments.length<=0||arguments[0]===undefined?"":arguments[0];var t=arguments.length<=1||arguments[1]===undefined?defaultRenderer:arguments[1];_classCallCheck(this,e);this.name=r;this.renderer=t;this.html=[];this.data=[]}_createClass(e,[{key:"add",value:function(){function r(r){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var n=e.encode(JSON.stringify(t));this.html.push(r);this.data.push(n);return this}return r}()},{key:"render",value:function(){function e(){var e=this;var r=this.html.reduce(function(r,t,n){var a=String(e.name)+"_"+String(n);return r+e.renderer.markup(t,a,e.name)},"");var t=this.data.reduce(function(r,t,n){var a=String(e.name)+"_"+String(n);return r+e.renderer.data(t,a,e.name)},"");return String(r)+"\n"+String(t)}return e}()}],[{key:"encode",value:function(){function e(e){var r=coerceToString(e);if(rEnc.test(r)){return r.replace(rLt,"&lt;").replace(rGt,"&gt;")}return r}return e}()},{key:"decode",value:function(){function e(e){var r=coerceToString(e);if(rDec.test(r)){return r.replace(rLte,"<").replace(rGte,">")}return r}return e}()},{key:"render",value:function(){function r(r){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];var n=arguments.length<=2||arguments[2]===undefined?"":arguments[2];var a=arguments.length<=3||arguments[3]===undefined?defaultRenderer:arguments[3];return new e(n,a).add(r,t).render()}return r}()},{key:"bootstrap",value:function(){function e(e){var r=arguments.length<=1||arguments[1]===undefined?defaultSelector:arguments[1];if(!e)return;var t=r();Object.keys(t).forEach(function(r){var n=t[r];var a=n.state;var u=n.node;e(a,u,r)})}return e}()}]);return e}();exports.default=Iso;
